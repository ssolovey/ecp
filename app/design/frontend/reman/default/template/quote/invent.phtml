<?php
/**
 * Reman Product Inventory Template
 *
 * @category    Reman
 * @package     Design
 * @author		Igor Zhavoronkin (zhavoronkin.i@gmail.com)
 */ 
		$_product = Mage::getModel('sync/applic')->loadProduct($this->getRequest()->getPost('id')); 
		//MKE Stock
		$mke = $_product->getData('parts_inventory_nc');
		//BWI Stock
		$bwi = $_product->getData('parts_inventory_ne');
		//ONT Stock
		$ont = $_product->getData('parts_inventory_sw');
		//ATL Stock
		$atl = $_product->getData('parts_inventory_se');
		//DALLAS Stock
		$dal = $_product->getData('parts_inventory_sc');
		//PORTLAND Stock
		$port = $_product->getData('parts_inventory_nw');
		//IP
		$ip = $_product->getData('parts_inventory_ip');
?>

<?php

    $isFluidShown = FALSE;

    // Current Logged Company
    $_company = Mage::helper('company')->getCustomerCompanyObject();

    //Flued Options
    /*
     * Parts Value: 7 = Required , 6 = Optional , 5 = None
     * Company VAlue: R = Required , O = Optional , N = None
     *
    */
    /* Requirement:
     *
     *  a. We do not need to show fluid capacity for Transfer casesß
     * 
     *  b. If the part number is hard keyed to show Required always show the capacity and “included” for the price (i.e. cft30s)
     *
     *  c.  Otherwise, use the customer’s file to determine if fluid shows.  
     *      Required and optional should always show capacity and cost.  None should not.
     */
    if ($_product->parts_fluid_option == 7) {       
        $isFluidShown = TRUE;           
    } else {
        $fluid = $_company->fluid;

        if (($fluid == "R") || ($fluid == "O")) {
            $isFluidShown = TRUE;
        }        
    }
?>

<!-- Stock Availability-->
<div id="stock_avl">
	<div class="title">Pricing</div>
    <table class="pricing">
    	<tr>
        	<td class="lable">Your price:</td>
            <td>$<?php echo number_format($_product->getPrice(),2,'.','');?></td>
        </tr>
        <tr>
        	<td class="lable">Core:</td>
            <td>$<?php echo number_format($_product->getData('parts_core_price'),2,'.','');?></td>
        </tr>
        
        <?php if ($isFluidShown): ?>
        <tr>
        	<td class="lable">Fluid price:</td>
            <td>$<?php echo number_format($_product->getData('parts_fluid_quantity')*5,2,'.','');?></td>
        </tr>
        <?php endif; ?>	

        <tr>
        	<td class="lable">Shipping:</td>
            <?php if(Mage::helper('company')->getCustomerShippingPrice() != "NULL"):?>	
                    <td><?php	echo "$".Mage::helper('company')->getCustomerShippingPrice();?></td>  
            <?php endif; ?>
            <?php if(Mage::helper('company')->getCustomerShippingPrice() == "NULL"):?>	
                    <td><?php echo "to be estimated based on Zip";?></td> 
            <?php endif; ?>		
        </tr>
        <tr style="height:20px;">
        	<td class="lable">MSRP:</td>
            <td>$<?php echo number_format($_product->getData('parts_msrp'),2,'.','');?></td>
        </tr>
        <tr>
            <td class="lable">Warranty:</td>
            <td>
            <?php 
                $partType = $_product->getName();
                echo Mage::helper('warranty')->getBaseWarranty($partType[0],$_product); 
            ?>
            </td>
        </tr>
    </table>
    
    
    <div style="margin-top:5px;" class="title">Availability</div>
    <table>
        <tr>
            <td class="lable">Milwaukee, WI:</td>
            <td id="mke">
				<?php 
					if($mke == 0 || $mke == null){
						echo 'PLEASE CALL';
					}else{
						echo '<span style="color:#f6193a">YES</span>';
					}
				?>
			</td>
        </tr>
        <tr>
            <td class="lable">Baltimore, MD:</td>
            <td id="bwi">
				<?php 
					if($bwi == 0 || $bwi == null){
						echo 'NO';
					}else{
						echo '<span style="color:#f6193a">YES</span>';
					}
				?>
            </td>
        </tr>
        <tr>
            <td class="lable">Ontario, CA:</td>
            <td id="ont">
				<?php 
					if($ont == 0 || $ont == null){
						echo 'NO';
					}else{
						echo '<span style="color:#f6193a">YES</span>';
					}
				?>
            </td>
        </tr>
        <tr>
            <td class="lable">Atlanta, GA:</td>
            <td id="atl">
				<?php 
					if($atl == 0 || $atl == null){
						echo 'NO';
					}else{
						echo '<span style="color:#f6193a">YES</span>';
					}
				?>
            </td>
        </tr>
        <tr>
            <td class="lable">Dallas, TX:</td>
            <td id="dal">
				<?php 
					if($dal == 0 || $dal == null){
						echo 'NO';
					}else{
						echo '<span style="color:#f6193a">YES</span>';
					}
				?>
            </td>
        </tr>
		<tr>
            <td class="lable">Portland, OR:</td>
            <td id="port">
				<?php 
					if($port == 0 || $port == null){
						echo 'NO';
					}else{
						echo '<span style="color:#f6193a">YES</span>';
					}
				?>
            </td>
        </tr>
    </table>
    
    <div class="bottom_message">
    	<?php
        if(($atl == 0 || $atl == null) && ($ont == 0 || $ont == null) && ($bwi == 0 || $bwi == null) && ($mke == 0 || $mke == null) && ($ip == 0 || $ip == null) && ($dal == 0 || $dal == null) && ($port == 0 || $port == null)){
        	echo "<div>CAll FOR AVAILABILITY</div>";
		}else{
			if ($mke == 0 || $mke == null) {
		        	echo "<div>CAll FOR AVAILABILITY</div>";
			}else{
				echo "<div>AVAILABLE TO SHIP WITHIN 24 HOURS</div>";
			}
		}
		?>
    </div>
</div>
