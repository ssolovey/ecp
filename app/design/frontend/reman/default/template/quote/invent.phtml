<?php
/**
 * Reman Product Pricing and Availability right side bar visual representaion
 * Shipping Estimation , Product Pricing , Product Availability
 * @category    Reman
 * @package     Design
 * @author		Igor Zhavoronkin (zhavoronkin.i@gmail.com)
 */ 
		$_product = Mage::getModel('sync/applic')->loadProduct($this->getRequest()->getPost('id')); 
		//MKE Stock
		$mke = (int)$_product->getData('parts_inventory_nc');
		//BWI Stock
		$bwi = (int)$_product->getData('parts_inventory_ne');
		//ONT Stock
		$ont = (int)$_product->getData('parts_inventory_sw');
		//ATL Stock
		$atl = (int)$_product->getData('parts_inventory_se');
		//DALLAS Stock
		$dal = (int)$_product->getData('parts_inventory_sc');

		//PORTLAND Stock
		$port = (int)$_product->getData('parts_inventory_nw');

		//IP
		$ip = (int)$_product->getData('parts_inventory_ip');


		
		// Current Logged Company
		$company = Mage::helper('company')->getCustomerCompanyObject();
		
		$array = array();
		
		if($bwi != 0 && $bwi != null){
			array_push($array, "21113");
		}
		
		array_push($array, "53223");
		
		if($ont != 0 && $ont != null){	
			array_push($array, "91761");
		}
		if($atl != 0 && $atl != null){	
			array_push($array, "30344");
		}
		
		if($dal != 0 && $dal != null){	
			array_push($array, "75261");
		}


        if($port != 0 && $port != null){
            array_push($array, "97201");
        }


		
		$SHIPPING_PRICE = 200;
		
		//check for In Progress Items
		if(($port == 0 || $port == null) && ($atl == 0 || $atl == null) && ($ont == 0 || $ont == null) && ($bwi == 0 || $bwi == null) && ($mke == 0 || $mke == null) && ($ip != 0 || $ip != null) && ($dal == 0 || $dal == null)){
			$inProgress = 1;
		}else{
			$inProgress = 0;
		}

?>

<?php

    $isFluidShown = FALSE;

    // Current Logged Company
    $_company = Mage::helper('company')->getCustomerCompanyObject();

    //Flued Options
    /*
    * Parts Value: 7 = Required , 6 = Optional , 5 = None
    * Company VAlue: R = Required , O = Optional , N = None
    *
    */
    /* Requirement:
    *
    *  a. We do not need to show fluid capacity for Transfer casesß
    *
    *  b. If the part number is hard keyed to show Required always show the capacity and “included” for the price (i.e. cft30s)
    *
    *  c.  Otherwise, use the customer’s file to determine if fluid shows.
    *      Required and optional should always show capacity and cost.  None should not.
    */
    if ($_product->parts_fluid_option == 7) {
        $isFluidShown = TRUE;
    } else {
        $fluid = $_company->fluid;

    if (($fluid == "R") || ($fluid == "O")) {
        $isFluidShown = TRUE;
        }
    }
?>

<div id="stock_avl">
    <div class="title">Pricing & Availability </div>
    <table id="ship-go-table" style="margin-bottom:25px;">
        <?php if(($port != 0 || $port != null) ||($atl != 0 || $atl != null) || ($ont != 0 || $ont != null) || ($bwi != 0 || $bwi != null) || ($mke != 0 || $mke != null) || ($ip != 0 || $ip != null) || ($dal != 0 || $dal != null)):?>
        <tr>
            <td>
                <input id="zip_value" value="" type="text" placeholder="Destination Zip" />
            </td>
            <td>
                <div id="estimate-shipping-btn"></div>
            </td>
        </tr>
        <?php endif; ?>
    </table>

    <table class="pricing">
        <tr>
            <td class="lable">Your price:</td>
            <td>$<?php echo number_format($_product->getPrice(),2,'.','');?></td>
        </tr>
        <tr>
            <td class="lable">Core:</td>
            <td>$<?php echo number_format($_product->getData('parts_core_price'),2,'.','');?></td>
        </tr>

        <?php if ($isFluidShown): ?>
        <tr>
            <td class="lable">Fluid price:</td>
            <td>$<?php echo number_format($_product->getData('parts_fluid_quantity')*5,2,'.','');?></td>
        </tr>
        <?php endif; ?>

        <tr>
            <td class="lable">Shipping:</td>
            <?php if(Mage::helper('company')->getCustomerShippingPrice() != "NULL"):?>
            <td><?php	echo "$".Mage::helper('company')->getCustomerShippingPrice();?></td>
            <?php endif; ?>
            <?php if(Mage::helper('company')->getCustomerShippingPrice() == "NULL"):?>
            <td><?php echo "to be estimated based on Zip";?></td>
            <?php endif; ?>
        </tr>
        <tr style="height:20px;">
            <td class="lable">MSRP:</td>
            <td>$<?php echo number_format($_product->getData('parts_msrp'),2,'.','');?></td>
        </tr>
        <tr>
            <td class="lable">Warranty:</td>
            <td>
                <?php
                $partType = $_product->getName();
                echo Mage::helper('warranty')->getBaseWarrantyLabel($partType[0],$_product);
                ?>
            </td>
        </tr>
    </table>


    <table>
        <tr>
            <td class="lable" width="60%">Milwaukee, WI:</td>
            <td id="mke">
                <?php
					if($mke == 0 || $mke == null){
						echo 'PLEASE CALL';
					}else{
						echo '<span style="color:#f6193a">YES</span>';
                }
                ?>
            </td>
        </tr>
        <tr>
            <td class="lable">Baltimore, MD:</td>
            <td id="bwi">
                <?php
					if($bwi == 0 || $bwi == null){
						echo 'NO';
					}else{
						echo '<span style="color:#f6193a">YES</span>';
                }
                ?>
            </td>
        </tr>
        <tr>
            <td class="lable">Ontario, CA:</td>
            <td id="ont">
                <?php
					if($ont == 0 || $ont == null){
						echo 'NO';
					}else{
						echo '<span style="color:#f6193a">YES</span>';
                }
                ?>
            </td>
        </tr>
        <tr>
            <td class="lable">Atlanta, GA:</td>
            <td id="atl">
                <?php
					if($atl == 0 || $atl == null){
						echo 'NO';
					}else{
						echo '<span style="color:#f6193a">YES</span>';
                }
                ?>
            </td>
        </tr>
        <tr>
            <td class="lable">Dallas, TX:</td>
            <td id="dal">
                <?php
					if($dal == 0 || $dal == null){
						echo 'NO';
					}else{
						echo '<span style="color:#f6193a">YES</span>';
                }
                ?>
            </td>
        </tr>
        <tr>
            <td class="lable">Portland, OR:</td>
            <td id="port">
                <?php
					if($port == 0 || $port == null){
						echo 'NO';
					}else{
						echo '<span style="color:#f6193a">YES</span>';
                }
                ?>
            </td>
        </tr>

    </table>

    <table>
        <tr>
            <td class="lable ship-from" style="display:none; font-weight: bold;">Ship From:</td>
            <td id="ship-from-value" class="ship-from" style="display:none; font-weight: bold;"></td>
        </tr>

        <tr>
            <td class="lable" style="font-weight: bold;">Availability:</td>
            <td style="width:100px; font-weight: bold;">
                <?php
					if(($port == 0 || $port == null) && ($atl == 0 || $atl == null) && ($ont == 0 || $ont == null) && ($bwi == 0 || $bwi == null) && ($mke == 0 || $mke == null) && ($ip == 0 || $ip == null) && ($dal == 0 || $dal == null)){
						echo "Call for availability";
					}else{
						echo "Immediate";
					}
		?>
            </td>
        </tr>
        <tr>
            <td class="lable ship-time" style="display:none; font-weight: bold;">Ship Time:</td>
            <td id="ship-time-value" class="ship-time" style="display:none; font-weight: bold;"></td>
        </tr>

    </table>

<?php /*?><<<<<<< HEAD<?php */?>
    <?php if(($port != 0 || $port != null) || ($atl != 0 || $atl != null) || ($ont != 0 || $ont != null) || ($bwi != 0 || $bwi != null) || ($mke != 0 || $mke != null) || ($ip != 0 || $ip != null) || ($dal != 0 || $dal != null)):?>
        <!--Allow Order only for Company "On Account" -->
    	<?php if($company->payment == 'ACCT') :?>
    		<div style="display:none;" id="order-now-btn"></div>
		<?php endif; ?>
       
        
     <?php endif; ?>
    <?php if($company->payment == 'PREPAY') :?>
        <div id="prepay" style="display:none;">PLEASE CALL US WITH YOUR ORDER</div>
    <?php endif; ?>    
<?php /*?>=======

    <div class="bottom_message">
    	<?php
        if(($atl == 0 || $atl == null) && ($ont == 0 || $ont == null) && ($bwi == 0 || $bwi == null) && ($mke == 0 || $mke == null) && ($ip == 0 || $ip == null) && ($dal == 0 || $dal == null) && ($port == 0 || $port == null)){
        	echo "<div>CAll FOR AVAILABILITY</div>";
		}else{
			if ($mke == 0 || $mke == null) {
		        	echo "<div>CAll FOR AVAILABILITY</div>";
			}else{
				echo "<div>AVAILABLE TO SHIP WITHIN 24 HOURS</div>";
			}
		}
		?>
    </div>
>>>>>>> prod/1.0<?php */?>
</div>

<script type="text/javascript">
	
	/* Enable jQuery Input PlaceHolders for IE*/
	initIEPlaceholders();
	
	//Estimate Shipping Event
	$j('#estimate-shipping-btn').click(function(){
		
		if($j("#zip_value").attr("value") != ""){
			estimateShipping(<?php echo json_encode($array); ?> , $j("#zip_value").attr("value") ,  <?php echo $inProgress; ?>);
		}
	});
	// Load Order Page
	$j('#order-now-btn').click(function(){
		Reman_QuickQuote.prototype.loadOrder($j('#zip_value').attr('value'));
	});
	// Trigger Shipping estimation on Enter Button Event
	$j('#zip_value').keydown(function(event) {
	  if (event.which == 13) {
		 if($j("#zip_value").attr("value") != ""){
			estimateShipping(<?php echo json_encode($array); ?> , $j("#zip_value").attr("value"));
		}
	   }
	});
	
	
	var total = <?php echo $_product->getPrice();?> + <?php echo Mage::helper('company')->getCustomerShippingPrice();?>+<?php echo $_product->getData('parts_core_price');?>;
	
	$j('#total-price-product-page').html('$' + total+ '.00');
</script>

